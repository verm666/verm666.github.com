<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
  
    <title>Shebang | verm666's blog</title>
    <link href="http://fonts.googleapis.com/css?family=Vollkorn&subset=latin" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/static/style.css" type="text/css">
    <link href="/feed.atom" rel="alternate" title="Recent Blog Posts" type="application/atom+xml">
    <link rel="stylesheet" href="/static/_pygments.css" type="text/css">
  
  </head>
  <body>
    <div class=container>
      <div class=header>
        <a href="/">verm666</a>'s blog
      </div>
      <div class=navigation>
        <ul>
          <li><a href="/">blog</a>
          <li><a href="/archive/">archive</a>
          <li><a href="/tags/">tags</a>
        </ul>
      </div>
      <div class=body>
      
  <h1 class="title">Shebang</h1>

  
  <p class=date>written on Thursday, December 15, 2011
  

  <p>В комлекте с ixgbe-3.9.2 идет небольшой скрипт, раскидывающий прерывания по
ядрам, но речь сейчас не о affinity.</p>
<div class="highlight"><pre>% head -2 scripts/set_irq_affinity.sh
# setting up irq affinity according to /proc/interrupts
# 2008-11-25 Robert Olsson
</pre></div>
<p>Вот так выглядят первые две строчки скрипта. Запускаем руками в консоли -
все хорошо. Без задней мысли дописываем в /etc/network/interfaces</p>
<div class="highlight"><pre>...
up /etc/network/set_irq_affinity.sh eth0
...
</pre></div>
<p>и теряем сервер.</p>
<p>Причина банальна - скрипт запускается в sh, который в debian squeeze является
символической ссылкой на dash. На 32 строке скрипта:</p>
<div class="highlight"><pre>...
for ((i=1; i&lt;=$IDX;i++)))
...
</pre></div>
<p>скрипт завершается с ошибкой <strong>Syntax error: Bad for loop variable</strong>.</p>
<div class="section" id="id1">
<h2>Выводы</h2>
<ul class="simple">
<li>Товарищи из Intel могли бы и подумать;</li>
<li>Никому нельзя верить и все надо проверять.</li>
</ul>
</div>
<div class="section" id="p-s">
<h2>p.s.</h2>
<p>Да, сервер еще не был в production и паника немного не уместна, но печально.</p>
</div>


  
  <p class=tags>This entry was tagged
    
      <a href="/tags/fuckup/">fuckup</a>, 
      <a href="/tags/ixgbe/">ixgbe</a>, 
      <a href="/tags/linux/">linux</a> and 
      <a href="/tags/shebang/">shebang</a>
  

      </div>
      <div class=footer>
          <a href="http://twitter.com/verm666">twitter</a>,
          <a href="http://github.com/verm666">github</a>,
          <a href="/feed.atom" rel="alternate" title="Recent Blog Posts">feed</a>
      </div>
    </div>
  </body>
</html>
