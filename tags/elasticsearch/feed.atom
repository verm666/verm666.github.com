<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title type="text">Recent Blog Posts</title>
  <id>http://verm666.github.com/feed.atom</id>
  <updated>2012-12-27T00:00:00Z</updated>
  <link href="http://verm666.github.com/" />
  <link href="http://verm666.github.com/feed.atom" rel="self" />
  <subtitle type="text">Recent blog posts</subtitle>
  <generator>Werkzeug</generator>
  <entry xml:base="http://verm666.github.com/feed.atom">
    <title type="text">ElasticSearch. Часть 1</title>
    <id>http://verm666.github.com/2012/12/27/elasticsearch_1</id>
    <updated>2012-12-27T00:00:00Z</updated>
    <link href="http://verm666.github.com/2012/12/27/elasticsearch_1" />
    <author>
      <name>verm666</name>
    </author>
    <content type="html">&lt;div class="section" id="id1"&gt;
&lt;h2&gt;Полезные ссылки&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;офф. сайт OpenSource проекта: &lt;a class="reference external" href="http://www.elasticsearch.org"&gt;http://www.elasticsearch.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;github: &lt;a class="reference external" href="https://github.com/elasticsearch"&gt;https://github.com/elasticsearch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;Версионирование&lt;/h2&gt;
&lt;p&gt;Первое с чем нужно определиться перед установкой - это зачем вам нужен
ElasticSearch. В зависимости от целей придется брать разные версии.&lt;/p&gt;
&lt;p&gt;Например: если вы хотите в качестве источника данных использовать CouchDB -
вам нужно будет поставить river, последняя версия которого совместима с релизом
ElasticSearch 0.18.7. Если вы будете сами наполнять ElasticSearch данными (
например через HTTP интерфейс) - то можно взять последний стабильный - 0.20.1.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h2&gt;Установка&lt;/h2&gt;
&lt;p&gt;Я не смотрел на мир Java порядка 4-х лет. И либо все стало совсем хорошо, либо
ребята из ElasticSearch постарались. Ставится поисковый движок за 2 минуты.&lt;/p&gt;
&lt;p&gt;Разумеется для работы нужен jdk. Моя текущая инсталляция работает на:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% java -version
java version &lt;span class="s2"&gt;&amp;quot;1.6.0_24&amp;quot;&lt;/span&gt;
OpenJDK Runtime Environment &lt;span class="o"&gt;(&lt;/span&gt;IcedTea6 1.11.5&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;rhel-1.50.1.11.5.el6_3-x86_64&lt;span class="o"&gt;)&lt;/span&gt;
OpenJDK 64-Bit Server VM &lt;span class="o"&gt;(&lt;/span&gt;build 20.0-b12, mixed mode&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Я приведу пример установки версии 0.18.7 (да, ниже будет показана работа с
CouchDB).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; /opt
% wget http://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.18.7.tar.gz
% tar zxfv elasticsearch-0.18.7.tar.gz
% ln -s elasticsearch-0.18.7 elasticsearch
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Запуск в foreground:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% &lt;span class="nb"&gt;cd &lt;/span&gt;elasticsearch
% ./bin/elasticsearch -f
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="couchdb-river"&gt;
&lt;h2&gt;CouchDB-river&lt;/h2&gt;
&lt;p&gt;River - это встраиваемая сущность в ElasticSearch, которая занимается
наполнением поискового движка данными.&lt;/p&gt;
&lt;p&gt;Установка river-а осуществляется через команду &lt;em&gt;plugin&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% ./bin/plugin -install river-couchdb
-&amp;gt; Installing river-couchdb...
Trying http://elasticsearch.googlecode.com/svn/plugins/river-couchdb/elasticsearch-river-couchdb-0.18.7.zip...
Downloading .........DONE
Installed river-couchdb
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Тоже самое можно сделать и самостоятельно. В результате у вас должно быть
следующее:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; /opt/elasticsearch
% find ./plugins
./plugins
./plugins/river-couchdb
./plugins/river-couchdb/elasticsearch-river-couchdb-0.18.7.jar
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;В случае CouchDB river подключается на &lt;a class="reference external" href="http://wiki.apache.org/couchdb/HTTP_database_API#Changes"&gt;_changes&lt;/a&gt;
для указанной нами базы и, получая свежие изменения добавляет их в поисковый
движок.&lt;/p&gt;
&lt;p&gt;Настройка river выглядит следующим образом:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% curl -XPUT &lt;span class="s1"&gt;&amp;#39;http://127.0.0.1:9200/_river/verm666/_meta&amp;#39;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;type&amp;quot; : &amp;quot;couchdb&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;couchdb&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;host&amp;quot; : &amp;quot;127.0.0.1&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;port&amp;quot; : 5984,&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;db&amp;quot; : &amp;quot;verm666&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;filter&amp;quot; : null&lt;/span&gt;
&lt;span class="s1"&gt;  },&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;index&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;index&amp;quot; : &amp;quot;verm666&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;type&amp;quot; : &amp;quot;verm666&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;bulk_size&amp;quot; : &amp;quot;100&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;quot;bulk_timeout&amp;quot; : &amp;quot;10ms&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;  }&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;После этого в логах CouchDB должна появиться запись вида:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% &lt;span class="o"&gt;[&lt;/span&gt;Thu, 27 Dec 2012 06:18:16 GMT&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;info&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&amp;lt;0.338.0&amp;gt;&lt;span class="o"&gt;]&lt;/span&gt; 127.0.0.1 - - &lt;span class="s1"&gt;&amp;#39;GET&amp;#39;&lt;/span&gt;
/verm666/_changes?feed&lt;span class="o"&gt;=&lt;/span&gt;continuous&amp;amp;include_docs&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;&amp;amp;heartbeat&lt;span class="o"&gt;=&lt;/span&gt;10000&amp;amp;since&lt;span class="o"&gt;=&lt;/span&gt;5 200
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;И по полям документов из CouchDB можно будет искать:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;% curl -XGET &lt;span class="s1"&gt;&amp;#39;http://localhost:9200/verm666/_search?q=name:Billy&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;_shards&amp;quot;&lt;/span&gt;: &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;failed&amp;quot;&lt;/span&gt;: 0,
        &lt;span class="s2"&gt;&amp;quot;successful&amp;quot;&lt;/span&gt;: 5,
        &lt;span class="s2"&gt;&amp;quot;total&amp;quot;&lt;/span&gt;: 5
    &lt;span class="o"&gt;}&lt;/span&gt;,
    &lt;span class="s2"&gt;&amp;quot;hits&amp;quot;&lt;/span&gt;: &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;hits&amp;quot;&lt;/span&gt;: &lt;span class="o"&gt;[&lt;/span&gt;
          &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;_id&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;b6cbe74d06265494d7b4bba297000068&amp;quot;&lt;/span&gt;,
            &lt;span class="s2"&gt;&amp;quot;_index&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;verm666&amp;quot;&lt;/span&gt;,
            &lt;span class="s2"&gt;&amp;quot;_score&amp;quot;&lt;/span&gt;: 1.0,
            &lt;span class="s2"&gt;&amp;quot;_source&amp;quot;&lt;/span&gt;: &lt;span class="o"&gt;{&lt;/span&gt;
              &lt;span class="s2"&gt;&amp;quot;_id&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;b6cbe74d06265494d7b4bba297000068&amp;quot;&lt;/span&gt;,
              &lt;span class="s2"&gt;&amp;quot;_rev&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;1-9349fbd38a04e647772c7c7be8b11d7a&amp;quot;&lt;/span&gt;,
              &lt;span class="s2"&gt;&amp;quot;byname&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;Wings&amp;quot;&lt;/span&gt;,
              &lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;Billy&amp;quot;&lt;/span&gt;,
              &lt;span class="s2"&gt;&amp;quot;quote&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;Pill popping, cunt eating, dope smoking, mother fucker.&amp;quot;&lt;/span&gt;
            &lt;span class="o"&gt;}&lt;/span&gt;,
            &lt;span class="s2"&gt;&amp;quot;_type&amp;quot;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;verm666&amp;quot;&lt;/span&gt;
          &lt;span class="o"&gt;}&lt;/span&gt;
      &lt;span class="o"&gt;]&lt;/span&gt;,
      &lt;span class="s2"&gt;&amp;quot;max_score&amp;quot;&lt;/span&gt;: 1.0,
      &lt;span class="s2"&gt;&amp;quot;total&amp;quot;&lt;/span&gt;: 1
    &lt;span class="o"&gt;}&lt;/span&gt;,
    &lt;span class="s2"&gt;&amp;quot;timed_out&amp;quot;&lt;/span&gt;: &lt;span class="nb"&gt;false&lt;/span&gt;,
    &lt;span class="s2"&gt;&amp;quot;took&amp;quot;&lt;/span&gt;: 2
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h2&gt;Выводы&lt;/h2&gt;
&lt;p&gt;Никаких выводов по итогам данной статьи я делать не буду. Про настройку
кластера, репликаций и шарднинга я напишу в след. части.&lt;/p&gt;
&lt;/div&gt;
</content>
  </entry>
</feed>

