<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
  
    <title>Приватный репозиторий OBS | verm666's blog</title>
    <link href="http://fonts.googleapis.com/css?family=Vollkorn&subset=latin" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/static/style.css" type="text/css">
    <link href="/feed.atom" rel="alternate" title="Recent Blog Posts" type="application/atom+xml">
    <link rel="stylesheet" href="/static/_pygments.css" type="text/css">
  
  </head>
  <body>
    <div class=container>
      <div class=header>
        <a href="/">verm666</a>'s blog
      </div>
      <div class=navigation>
        <ul>
          <li><a href="/">blog</a>
          <li><a href="/archive/">archive</a>
          <li><a href="/tags/">tags</a>
        </ul>
      </div>
      <div class=body>
      
  <h1 class="title">Приватный репозиторий OBS</h1>

  
  <p class=date>written on Sunday, January 15, 2012
  

  <div class="section" id="id1">
<h2>Вступление</h2>
<p>После того, как в субботу вечером в очередной раз build.opensuse.org лег и начал
отдавать на все запросы 503 терпение закончилось и было решено отвязаться
от внешнего сервиса окончательно.</p>
<p>В wiki проекта можно найти несколько упоминаний о том, как это можно сделать. Но
на примере rpm-based дистрибутивов. И ни одного примера для Debian. Ниже будет
описано как это сделать для Debian 6.0 (x86_64).</p>
</div>
<div class="section" id="forever-alone">
<h2>Forever alone</h2>
<ul class="simple">
<li>Создаем новый проект в OBS (Debian);</li>
<li>Создаем в нем подпроект (6:0);</li>
<li>Вносим изменения в Raw config проекта (Project-&gt;Advanced-&gt;Raw Config);</li>
</ul>
<div class="highlight"><pre><span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;Debian:6.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>6.0<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;description/&gt;</span>
  <span class="nt">&lt;person</span> <span class="na">role=</span><span class="s">&quot;maintainer&quot;</span> <span class="na">userid=</span><span class="s">&quot;verm666&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;person</span> <span class="na">role=</span><span class="s">&quot;bugowner&quot;</span> <span class="na">userid=</span><span class="s">&quot;verm666&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;repository</span> <span class="na">name=</span><span class="s">&quot;standard&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arch&gt;</span>x86_64<span class="nt">&lt;/arch&gt;</span>
  <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
<ul class="simple">
<li>Заливаем projconf (Projct-&gt;Advanced-&gt;Project Config);</li>
</ul>
<p>Именно из-за этого пункта я пишу эту заметку. Т.к. готового конфига в rpm
пакетах OBS нет (если для Lenny, но он немного не работает),
а при лежащем build.opensuse.org искать его, по факту, негде.</p>
<p>Мой projconf для Debian_6.0 можно взять <a class="reference external" href="/static/my/Debian_6.0_prjconf.txt">тут</a>.</p>
<ul class="simple">
<li>Заходим на сервер по ssh и создаем директорию для бинарных пакетов нашего проекта:</li>
</ul>
<div class="highlight"><pre># mkdir -p /srv/obs/build/Debian\:6.0/standard/x86_64/\:full/
</pre></div>
<p>Кладем в эту директорию все пакеты для Debian Squeeze x86_64
(я использовал debmirror);</p>
<p>Индексируем проект:</p>
<div class="highlight"><pre># /usr/lib/obs/server/bs_admin --rescan-repository Debian:6.0 standard x86_64
</pre></div>
<p>Смотрим логи obsscheduler'а:</p>
<div class="highlight"><pre># tail -f /srv/obs/log/scheduler_x86_64.log
</pre></div>
</div>
<div class="section" id="id3">
<h2>Сборка пакетов</h2>
<p>Для сборки своих пакетов создается отдельный репозиторий и подключается как
build target через advanced interface (Or pick one via advanced interface. На
странице с репозиториями проекта)</p>
<p>Hint: В 'New name' лучше указывать Debian_6.0 (такое же название, какое
используется при работе с внешним OBS. Таким образом после отключения внешнего
OBS ссылки на репозиторий с deb пакетами останутся прежними и вам не придется
вносить изменения в sources.list)</p>
</div>
<div class="section" id="id4">
<h2>Ссылки по теме</h2>
<ul class="simple">
<li><a class="reference external" href="http://en.opensuse.org/openSUSE:Build_Service_prjconf">http://en.opensuse.org/openSUSE:Build_Service_prjconf</a></li>
<li><a class="reference external" href="http://en.opensuse.org/openSUSE:Build_Service_adding_build_targets">http://en.opensuse.org/openSUSE:Build_Service_adding_build_targets</a></li>
<li><a class="reference external" href="http://en.opensuse.org/openSUSE:Build_Service_private_instance_boot_strapping">http://en.opensuse.org/openSUSE:Build_Service_private_instance_boot_strapping</a></li>
</ul>
</div>


  
  <p class=tags>This entry was tagged
    
      <a href="/tags/503/">503</a>, 
      <a href="/tags/debian/">debian</a> and 
      <a href="/tags/obs/">obs</a>
  

      </div>
      <div class=footer>
          <a href="http://twitter.com/verm666">twitter</a>,
          <a href="http://github.com/verm666">github</a>,
          <a href="/feed.atom" rel="alternate" title="Recent Blog Posts">feed</a>
      </div>
    </div>
  </body>
</html>
