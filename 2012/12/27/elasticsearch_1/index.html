<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
  
    <title>ElasticSearch. Часть 1 | verm666's blog</title>
    <link href="http://fonts.googleapis.com/css?family=Vollkorn&subset=latin" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/static/style.css" type="text/css">
    <link href="/feed.atom" rel="alternate" title="Recent Blog Posts" type="application/atom+xml">
    <link rel="stylesheet" href="/static/_pygments.css" type="text/css">
  
  </head>
  <body>
    <div class=container>
      <div class=header>
        <a href="/">verm666</a>'s blog
      </div>
      <div class=navigation>
        <ul>
          <li><a href="/">blog</a>
          <li><a href="/archive/">archive</a>
          <li><a href="/tags/">tags</a>
        </ul>
      </div>
      <div class=body>
      
  <h1 class="title">ElasticSearch. Часть 1</h1>

  
  <p class=date>written on Thursday, December 27, 2012
  

  <div class="section" id="id1">
<h2>Полезные ссылки</h2>
<ul class="simple">
<li>офф. сайт OpenSource проекта: <a class="reference external" href="http://www.elasticsearch.org">http://www.elasticsearch.org</a></li>
<li>github: <a class="reference external" href="https://github.com/elasticsearch">https://github.com/elasticsearch</a></li>
</ul>
</div>
<div class="section" id="id2">
<h2>Версионирование</h2>
<p>Первое с чем нужно определиться перед установкой - это зачем вам нужен
ElasticSearch. В зависимости от целей придется брать разные версии.</p>
<p>Например: если вы хотите в качестве источника данных использовать CouchDB -
вам нужно будет поставить river, последняя версия которого совместима с релизом
ElasticSearch 0.18.7. Если вы будете сами наполнять ElasticSearch данными (
например через HTTP интерфейс) - то можно взять последний стабильный - 0.20.1.</p>
</div>
<div class="section" id="id3">
<h2>Установка</h2>
<p>Я не смотрел на мир Java порядка 4-х лет. И либо все стало совсем хорошо, либо
ребята из ElasticSearch постарались. Ставится поисковый движок за 2 минуты.</p>
<p>Разумеется для работы нужен jdk. Моя текущая инсталляция работает на:</p>
<div class="highlight"><pre>% java -version
java version <span class="s2">&quot;1.6.0_24&quot;</span>
OpenJDK Runtime Environment <span class="o">(</span>IcedTea6 1.11.5<span class="o">)</span> <span class="o">(</span>rhel-1.50.1.11.5.el6_3-x86_64<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>build 20.0-b12, mixed mode<span class="o">)</span>
</pre></div>
<p>Я приведу пример установки версии 0.18.7 (да, ниже будет показана работа с
CouchDB).</p>
<div class="highlight"><pre>% <span class="nb">cd</span> /opt
% wget http://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.18.7.tar.gz
% tar zxfv elasticsearch-0.18.7.tar.gz
% ln -s elasticsearch-0.18.7 elasticsearch
</pre></div>
<p>Запуск в foreground:</p>
<div class="highlight"><pre>% <span class="nb">cd </span>elasticsearch
% ./bin/elasticsearch -f
</pre></div>
</div>
<div class="section" id="couchdb-river">
<h2>CouchDB-river</h2>
<p>River - это встраиваемая сущность в ElasticSearch, которая занимается
наполнением поискового движка данными.</p>
<p>Установка river-а осуществляется через команду <em>plugin</em>:</p>
<div class="highlight"><pre>% ./bin/plugin -install river-couchdb
-&gt; Installing river-couchdb...
Trying http://elasticsearch.googlecode.com/svn/plugins/river-couchdb/elasticsearch-river-couchdb-0.18.7.zip...
Downloading .........DONE
Installed river-couchdb
</pre></div>
<p>Тоже самое можно сделать и самостоятельно. В результате у вас должно быть
следующее:</p>
<div class="highlight"><pre>% <span class="nb">cd</span> /opt/elasticsearch
% find ./plugins
./plugins
./plugins/river-couchdb
./plugins/river-couchdb/elasticsearch-river-couchdb-0.18.7.jar
</pre></div>
<p>В случае CouchDB river подключается на <a class="reference external" href="http://wiki.apache.org/couchdb/HTTP_database_API#Changes">_changes</a>
для указанной нами базы и, получая свежие изменения добавляет их в поисковый
движок.</p>
<p>Настройка river выглядит следующим образом:</p>
<div class="highlight"><pre>% curl -XPUT <span class="s1">&#39;http://127.0.0.1:9200/_river/verm666/_meta&#39;</span> -d <span class="s1">&#39;{</span>
<span class="s1">  &quot;type&quot; : &quot;couchdb&quot;,</span>
<span class="s1">  &quot;couchdb&quot; : {</span>
<span class="s1">      &quot;host&quot; : &quot;127.0.0.1&quot;,</span>
<span class="s1">      &quot;port&quot; : 5984,</span>
<span class="s1">      &quot;db&quot; : &quot;verm666&quot;,</span>
<span class="s1">      &quot;filter&quot; : null</span>
<span class="s1">  },</span>
<span class="s1">  &quot;index&quot; : {</span>
<span class="s1">      &quot;index&quot; : &quot;verm666&quot;,</span>
<span class="s1">      &quot;type&quot; : &quot;verm666&quot;,</span>
<span class="s1">      &quot;bulk_size&quot; : &quot;100&quot;,</span>
<span class="s1">      &quot;bulk_timeout&quot; : &quot;10ms&quot;</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span>
</pre></div>
<p>После этого в логах CouchDB должна появиться запись вида:</p>
<div class="highlight"><pre>% <span class="o">[</span>Thu, 27 Dec 2012 06:18:16 GMT<span class="o">]</span> <span class="o">[</span>info<span class="o">]</span> <span class="o">[</span>&lt;0.338.0&gt;<span class="o">]</span> 127.0.0.1 - - <span class="s1">&#39;GET&#39;</span>
/verm666/_changes?feed<span class="o">=</span>continuous&amp;include_docs<span class="o">=</span><span class="nb">true</span>&amp;heartbeat<span class="o">=</span>10000&amp;since<span class="o">=</span>5 200
</pre></div>
<p>И по полям документов из CouchDB можно будет искать:</p>
<div class="highlight"><pre>% curl -XGET <span class="s1">&#39;http://localhost:9200/verm666/_search?q=name:Billy&#39;</span>
<span class="o">{</span>
    <span class="s2">&quot;_shards&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;failed&quot;</span>: 0,
        <span class="s2">&quot;successful&quot;</span>: 5,
        <span class="s2">&quot;total&quot;</span>: 5
    <span class="o">}</span>,
    <span class="s2">&quot;hits&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;hits&quot;</span>: <span class="o">[</span>
          <span class="o">{</span>
            <span class="s2">&quot;_id&quot;</span>: <span class="s2">&quot;b6cbe74d06265494d7b4bba297000068&quot;</span>,
            <span class="s2">&quot;_index&quot;</span>: <span class="s2">&quot;verm666&quot;</span>,
            <span class="s2">&quot;_score&quot;</span>: 1.0,
            <span class="s2">&quot;_source&quot;</span>: <span class="o">{</span>
              <span class="s2">&quot;_id&quot;</span>: <span class="s2">&quot;b6cbe74d06265494d7b4bba297000068&quot;</span>,
              <span class="s2">&quot;_rev&quot;</span>: <span class="s2">&quot;1-9349fbd38a04e647772c7c7be8b11d7a&quot;</span>,
              <span class="s2">&quot;byname&quot;</span>: <span class="s2">&quot;Wings&quot;</span>,
              <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;Billy&quot;</span>,
              <span class="s2">&quot;quote&quot;</span>: <span class="s2">&quot;Pill popping, cunt eating, dope smoking, mother fucker.&quot;</span>
            <span class="o">}</span>,
            <span class="s2">&quot;_type&quot;</span>: <span class="s2">&quot;verm666&quot;</span>
          <span class="o">}</span>
      <span class="o">]</span>,
      <span class="s2">&quot;max_score&quot;</span>: 1.0,
      <span class="s2">&quot;total&quot;</span>: 1
    <span class="o">}</span>,
    <span class="s2">&quot;timed_out&quot;</span>: <span class="nb">false</span>,
    <span class="s2">&quot;took&quot;</span>: 2
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="id4">
<h2>Выводы</h2>
<p>Никаких выводов по итогам данной статьи я делать не буду. Про настройку
кластера, репликаций и шарднинга я напишу в след. части.</p>
</div>


  
  <p class=tags>This entry was tagged
    
      <a href="/tags/couchdb/">couchdb</a> and 
      <a href="/tags/elasticsearch/">elasticsearch</a>
  

      </div>
      <div class=footer>
          <a href="http://twitter.com/verm666">twitter</a>,
          <a href="http://github.com/verm666">github</a>,
          <a href="/feed.atom" rel="alternate" title="Recent Blog Posts">feed</a>
      </div>
    </div>
  </body>
</html>
